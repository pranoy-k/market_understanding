{
  "id": "2S5igjYpOufVq1JG",
  "meta": {
    "instanceId": "0c91cd2a3133931f13781d4dcd6db321515413596b36e6bddb494176726841a7"
  },
  "name": "n8n-vapi-lead-verifier-final V140525.8",
  "tags": [
    {
      "id": "a6b41kNUtX65uzIo",
      "name": "tuguidragos.com",
      "createdAt": "2025-05-14T18:52:56.055Z",
      "updatedAt": "2025-05-14T18:52:56.055Z"
    }
  ],
  "nodes": [
    {
      "id": "5b5b34b0-3f13-4cfc-a840-8a8ccbb13675",
      "name": "Step 1 - Create Customer",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -480,
        380
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "7582ac6e-3889-4304-87f4-4ba441981e9f",
      "name": "Step 2 - Initiate Call",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -300,
        180
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "8878a9b9-5277-4e7b-b0c2-b4e8766306f2",
      "name": "Step 3 - Get Call Data",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        120,
        620
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "8a6d0f05-c980-4d72-979a-cad626977680",
      "name": "Step 4 - Set (Parse Call Result)",
      "type": "n8n-nodes-base.set",
      "position": [
        320,
        620
      ],
      "parameters": {},
      "typeVersion": 3.4
    },
    {
      "id": "2933b043-9652-4524-8183-9c8e6223597f",
      "name": "Step 5 - If (Call Answered?)",
      "type": "n8n-nodes-base.if",
      "position": [
        500,
        620
      ],
      "parameters": {},
      "typeVersion": 2.2
    },
    {
      "id": "1dbc81ea-928e-4ed1-b6b9-8a865ed8e6fa",
      "name": "Step 5.2 - Notify Slack (No Answer)",
      "type": "n8n-nodes-base.slack",
      "position": [
        1080,
        460
      ],
      "webhookId": "8f9d1ea8-de8c-42c0-92cd-da4b356c27bb",
      "parameters": {},
      "typeVersion": 2.3
    },
    {
      "id": "40506826-48db-480e-ae93-2c66c5688d07",
      "name": "Step 5.1.1- Extract Email (Regex)",
      "type": "n8n-nodes-base.code",
      "position": [
        860,
        780
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "1f39c551-dd7c-4a72-b80d-946349f310ee",
      "name": "Step 5.1.3 - Notify Slack (Lead Success)",
      "type": "n8n-nodes-base.slack",
      "position": [
        1300,
        780
      ],
      "webhookId": "cd2bc6c7-3f50-47fb-9c84-e2743a355877",
      "parameters": {},
      "notesInFlow": false,
      "typeVersion": 2.3
    },
    {
      "id": "6995a5c9-766d-4c90-bc41-8e0674af9369",
      "name": "Set Attempt Count + Init Status",
      "type": "n8n-nodes-base.code",
      "position": [
        120,
        180
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "79867b7b-166f-4b5d-84f7-aac352868c3e",
      "name": "Get Call Status from VAPI",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        360,
        180
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "f4cecdc2-4ddc-420d-bb73-359095f03b72",
      "name": "Check Final Status + shouldContinue Logic",
      "type": "n8n-nodes-base.code",
      "position": [
        560,
        180
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "3ebcf937-73ff-425d-bc2b-1da7d1210ee1",
      "name": "Prepare Loop Payload",
      "type": "n8n-nodes-base.set",
      "position": [
        1240,
        160
      ],
      "parameters": {},
      "typeVersion": 3.4
    },
    {
      "id": "431a2339-0353-4781-bc65-1ffbe7a780e1",
      "name": "Should Continue Loop?",
      "type": "n8n-nodes-base.if",
      "position": [
        760,
        180
      ],
      "parameters": {},
      "typeVersion": 2.2
    },
    {
      "id": "c880979d-0342-4f39-ae01-d0a58341d744",
      "name": "Wait Before Retry",
      "type": "n8n-nodes-base.wait",
      "position": [
        1060,
        160
      ],
      "webhookId": "25a8962b-38d1-4283-be7d-c7e6240e78e3",
      "parameters": {},
      "typeVersion": 1.1
    },
    {
      "id": "b69746b3-9939-4899-bb32-3430906597a8",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "a7ed8451-f066-492b-bf0f-405e9c27fd6b",
      "name": "Clean Phone Number",
      "type": "n8n-nodes-base.code",
      "position": [
        -640,
        180
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "0f80b64d-73af-4af0-8d9e-cf709b6d55cb",
      "name": "Step 5.1 - Update Lead (No Answer)",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        860,
        460
      ],
      "parameters": {},
      "typeVersion": 4.5
    },
    {
      "id": "f62ecc21-326c-4fc1-b201-4e05c6bcb23f",
      "name": "Step 5.1.2 - Update Lead (Completed)",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        1080,
        780
      ],
      "parameters": {},
      "typeVersion": 4.5
    },
    {
      "id": "7c861b96-832e-4fe1-a4a0-de39cf5b54a6",
      "name": "Filter Valid Leads",
      "type": "n8n-nodes-base.code",
      "position": [
        -1060,
        400
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "d96cc9e9-1310-4018-814f-e53f8d68b73e",
      "name": "Has Leads to Process?",
      "type": "n8n-nodes-base.if",
      "position": [
        -860,
        400
      ],
      "parameters": {},
      "executeOnce": false,
      "typeVersion": 2.2,
      "alwaysOutputData": false
    },
    {
      "id": "3b53b21d-0ca0-4660-862d-4d593519ee95",
      "name": "Slack - All Done",
      "type": "n8n-nodes-base.slack",
      "position": [
        -640,
        620
      ],
      "webhookId": "ea864253-cffd-4a16-8c58-8f6a79f20f84",
      "parameters": {},
      "notesInFlow": false,
      "typeVersion": 2.3
    },
    {
      "id": "fb6f369d-2602-4e18-9895-224e9161146f",
      "name": "Sync Updated Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        800,
        1040
      ],
      "parameters": {},
      "typeVersion": 4.5,
      "alwaysOutputData": true
    },
    {
      "id": "6ab553de-73bf-4924-8d08-95d93bf36be3",
      "name": "Load Lead Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        -1240,
        600
      ],
      "parameters": {},
      "typeVersion": 4.5,
      "alwaysOutputData": true
    },
    {
      "id": "3d41c6d4-8ff4-4767-8a3c-443fc328b7f1",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "position": [
        -1420,
        600
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "53326fbe-0529-434f-a2f8-a65c70681cc5",
      "name": "Loop Setup Variables",
      "type": "n8n-nodes-base.set",
      "position": [
        -140,
        400
      ],
      "parameters": {},
      "typeVersion": 3.4
    },
    {
      "id": "02ed9c39-93bb-45b1-b6b7-0a7df8249da6",
      "name": "Wait Before Sheet Refresh",
      "type": "n8n-nodes-base.wait",
      "position": [
        580,
        1040
      ],
      "webhookId": "3371d280-de4b-4c6f-b272-ff54f061ab27",
      "parameters": {},
      "executeOnce": false,
      "typeVersion": 1.1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "252425b9-6480-4af9-9a96-2d52e07f7101",
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Load Lead Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Load Lead Sheet": {
      "main": [
        [
          {
            "node": "Filter Valid Leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait Before Retry": {
      "main": [
        [
          {
            "node": "Prepare Loop Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean Phone Number": {
      "main": [
        [
          {
            "node": "Step 1 - Create Customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Valid Leads": {
      "main": [
        [
          {
            "node": "Has Leads to Process?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sync Updated Sheet": {
      "main": [
        [
          {
            "node": "Load Lead Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Setup Variables": {
      "main": [
        [
          {
            "node": "Set Attempt Count + Init Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Loop Payload": {
      "main": [
        [
          {
            "node": "Set Attempt Count + Init Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Leads to Process?": {
      "main": [
        [
          {
            "node": "Clean Phone Number",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Slack - All Done",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Should Continue Loop?": {
      "main": [
        [
          {
            "node": "Wait Before Retry",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Step 3 - Get Call Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 2 - Initiate Call": {
      "main": [
        [
          {
            "node": "Loop Setup Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 3 - Get Call Data": {
      "main": [
        [
          {
            "node": "Step 4 - Set (Parse Call Result)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 1 - Create Customer": {
      "main": [
        [
          {
            "node": "Step 2 - Initiate Call",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Call Status from VAPI": {
      "main": [
        [
          {
            "node": "Check Final Status + shouldContinue Logic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait Before Sheet Refresh": {
      "main": [
        [
          {
            "node": "Sync Updated Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 5 - If (Call Answered?)": {
      "main": [
        [
          {
            "node": "Wait Before Sheet Refresh",
            "type": "main",
            "index": 0
          },
          {
            "node": "Step 5.1 - Update Lead (No Answer)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Step 5.1.1- Extract Email (Regex)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Attempt Count + Init Status": {
      "main": [
        [
          {
            "node": "Get Call Status from VAPI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 4 - Set (Parse Call Result)": {
      "main": [
        [
          {
            "node": "Step 5 - If (Call Answered?)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 5.1.1- Extract Email (Regex)": {
      "main": [
        [
          {
            "node": "Step 5.1.2 - Update Lead (Completed)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 5.1 - Update Lead (No Answer)": {
      "main": [
        [
          {
            "node": "Step 5.2 - Notify Slack (No Answer)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Step 5.1.2 - Update Lead (Completed)": {
      "main": [
        [
          {
            "node": "Wait Before Sheet Refresh",
            "type": "main",
            "index": 0
          },
          {
            "node": "Step 5.1.3 - Notify Slack (Lead Success)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Final Status + shouldContinue Logic": {
      "main": [
        [
          {
            "node": "Should Continue Loop?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}